# CHECKLIST + ROAD MAP

Комбинированный чек-лист и дорожная карта по приложению «План-график» фиксируют текущее состояние интерфейса, перечисляют визуальные и поведенческие проблемы и помогают планировать доработки. После каждого изменения обновляйте статусы, даты и план работ.

## Глобальные наблюдения
- **Шрифты.** Конфигурация по умолчанию (`data/config.json`) устанавливает `header_font` и `sidebar_font` в значение
  `Cattedrale [RUS by penka220]`, тогда как рендерер стабильно отображает только семейство Exo 2. Попытка загрузить кастомный
  файл приводит к нечитабельному тексту и ранее блокировала запуск приложения. Требуется сохранить Exo 2 в качестве
  дефолтной гарнитуры и одновременно проработать безопасную поддержку графических шрифтов (отдельная директория ресурсов,
  fallback при ошибке, проверка наличия глифов). 2025-09-17: внедрён белый список ресурсов и проверка обязательных латинских и
  кириллических глифов; при отсутствии валидных файлов конфиг откатывается к Exo 2.
- **Единый стиль кнопок.** StyledToolButton/StyledPushButton визуально отличаются друг от друга: заметны острые углы у элементов
  со скруглением, текст в кнопках навигации и диалогов смещён к левому краю, при наведении используется серая заливка и неон
  полностью гаснет. Нужен общий компонент с центровкой текста и стабильной подсветкой. 2025-10-02: кнопки сайдбара перешли на
  собственный рендер с центровкой иконки и текста без ручных пробелов, неон сохраняется после активации.
- **Неоновая подсветка.** Нет единого правила, где и как она работает: в большинстве экранов при наведении она исчезает, на
  некоторых кнопках свет не выходит наружу, а рамки становятся угловатыми. Текущий UI допускает отключение неона, хотя он должен
  быть активен постоянно. Требуется единая система состояний «статичное / активное / динамичное» с режимом always-on.
- **Сохранение состояний.** Диалоги из левого бара постепенно получают персистентность: «Вводные» и «Топы» уже запоминают
  геометрию, ширину столбцов и выбранную сортировку, но остальным окнам всё ещё требуется доработка по сохранению параметров.
  2025-09-26: данные календаря сохраняются в выбранном пользователем каталоге `save_path` (поддиректория `months`), смена
  пути не создаёт новые файлы в устаревшем `data/`.
- **Архитектура.** Код разросся за счёт копипаста стилей и обработчиков; отсутствует модульность и ООП-подход для повторяющихся
  элементов (кнопки, поля, таблицы). Есть отключённые блоки, которые не удалены.

## Главный экран

### Левый сайдбар
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата последней проверки |
| --- | --- | --- | --- | --- |
| Корпус боковой панели | Фон синхронизируется с `sidebar_color` (`#1f1f23`), ширина 260 px; углы выглядят зубчатыми, заголовки подхватывают Cattedrale вместо Exo 2. | Сворачивание анимирует ширину, фон обновляется, неон подсвечивает края угловато и без внешнего свечения. | требует доработки | 2025-09-16 |
| Кнопка «Свернуть панель» | Градиент `#39ff14→#2d7cdb`, радиус 16 px, иконка 28×28 цвета `#ffffff`; отсутствие текста подчёркивает смещение и острые углы. | Hover: фон `#3a3a3a`, подсветка и неон гаснут, масштаб не меняется; иконка тускнеет, после клика подсветка не возвращается. | требует доработки | 2025-09-16 |
| Кнопка «Вводные» | Exo 2 16 px, текст `#ffffff` и иконка `#39ff14` центрируются внутри градиента `#39ff14→#2d7cdb`, радиус 16 px; углы рендерятся ступенчато. 2025-10-02: ручные пробелы убраны, контент центрирован. | Hover: заливка сереет, текст обесцвечивается до `#bfbfbf`, неон отключается, внешнее свечение отсутствует; активное состояние сбрасывается после закрытия окна. | частично решено | 2025-10-02 |
| Кнопка «Выкладка» | Аналогично «Вводные»: Exo 2 16 px, текст `#ffffff`, иконка 22×22 `#39ff14`, центрируется внутри кнопки. | Hover/клик: градиент тускнеет до серого, текст неонового свечения не получает, внешнего ореола нет, неон гаснет частично. | частично решено | 2025-10-02 |
| Кнопка «Аналитика» | StyledToolButton с Exo 2 16 px, текст `#ffffff`, иконка `#39ff14` центрированы; визуально видны острые углы. | Hover: фон сереет, текст становится `#bfbfbf`, неон и подсветка исчезают; после закрытия диалога подсветка не восстанавливается. | частично решено | 2025-10-02 |
| Кнопка «Топы» | Текст `#ffffff` и иконка `#39ff14` выровнены по центру без пустого поля справа; углы неровные. | Hover: фон серый, текст тускнеет до `#bfbfbf`, неон гаснет, свечение по контуру отсутствует; при открытии окна подсветка сбрасывается. | частично решено | 2025-10-02 |
| Кнопка «Настройки» | Icon-only, градиент `#39ff14→#2d7cdb`, радиус 16 px; края выглядят острыми, подсветка узкая, иконка `#ffffff`. | Hover: фон сереет, неон и рамка исчезают, наружное свечение отсутствует даже при активном режиме. | требует доработки | 2025-09-16 |

### Верхняя панель (TopBar)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Фон TopBar | Цвет синхронизирован с календарём (по умолчанию `#222222`), переход к центральной области выглядит квадратным. | При смене темы фон обновляется, но поле года остаётся иного цвета и выбивается из общего тона. 2025-09-25: базовый стиль топ-бара пересобирается при каждом обновлении темы, прежние `background-color` больше не наслаиваются. | частично решено | 2025-09-25 |
| Кнопки «Предыдущий/Следующий» | Градиент `#39ff14→#2d7cdb`, радиус 16 px, стрелки 22×22 цвета `#ffffff`; отсутствие текста подчёркивает смещение и острые углы. | Hover: фон становится `#3a3a3a`, иконка тускнеет до `#bfbfbf`, наружного неона нет. | требует доработки | 2025-09-16 |
| Метка месяца | QLabel, планируемый Exo 2 Bold 24 px, но конфиг подставляет Cattedrale; цвет скачет между `#ffffff` и `#39ff14`. | При смене темы цвет без логики переключается между состояниями, текст светится даже без активного неона. | требует доработки | 2025-09-16 |
| Поле года | QSpinBox без стрелок, ширина избыточна; текст Exo 2 18 px выровнен по левому краю, фон отличается от топ-бара. | Hover: фон не синхронизируется, бордер угловат, текст не центрируется; при смене темы цвет поля не обновляется. | требует доработки | 2025-09-16 |

### Центральная рабочая область (календарь)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Таблица месяца (ExcelCalendarTable) | 7×6 ячеек, фон из `workspace_color`, внешние углы выглядят острыми. | Клик по ячейке подсвечивает все границы таблицы; двойной клик подсвечивает весь календарь. | требует доработки | 2025-09-16 |
| Контейнер дня | QWidget с радиусом 8 px, но активная ячейка визуально квадратная. | Hover: фон меняется и не всегда возвращается; клик увеличивает масштаб и ломает скругление. | требует доработки | 2025-09-16 |
| Внутренняя таблица дня | NeonTableWidget с 6 строками («Работа/План/Готово»). | Выбор подсвечивает всю таблицу, заголовки всех столбцов начинают светиться, масштаб строки скачет. | требует доработки | 2025-09-16 |
| Заголовки столбцов внутри дня | Exo 2, но фон отличается от календаря. | Цвет и фон меняются в зависимости от действий, нет статического состояния. | требует доработки | 2025-09-16 |
| Заголовок дней недели (ПН…ВС) | Отдельная заливка, отличная от календаря; шрифт и цвет корректны. | Hover на первой неделе подсвечивает число серым, на остальных неделях поведение непредсказуемо. | требует доработки | 2025-09-16 |

### Нижний статус-бар
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Таймер | QLabel «ДД:ЧЧ:ММ:СС», Exo 2 Regular, системный размер ~9 pt, цвет из палитры светлой темы (`#202020`). | Обновляется раз в секунду, подсветка и цвет стабильны. | работает | 2025-09-16 |
| Метка версии | QLabel `v<номер>`, Exo 2 Regular ~9 pt, цвет `#202020`; файл `VERSION` содержит актуальную `3.1.2`, обновление выполняется вручную. | Обновление версии не автоматизировано, фиксы не повышают номер. | требует доработки | 2025-09-17 |
| Фон статус-бара | Цвет синхронизирован с календарём. | Изменения цвета применяются корректно. | работает | 2025-09-16 |

## Диалоги

### «Настройки» (SettingsDialog)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Поле «Строк на день» | QSpinBox без стрелок, фон синхронизируется с `workspace_color`, рамка повторяет `accent_color` и текущую толщину неона. | Hover/фокус: контур усиливается в акцентный цвет, фильтр `NeonEventFilter` остаётся активным. | решено | 2025-09-17 |
| Группа «Неон» | Комбобокс с пресетами («Мягкий», «Стандарт», «Яркий») и три горизонтальных ползунка с цифровыми индикаторами. | Выбор профиля мгновенно обновляет ползунки и сохраняет конфигурацию; ручная подстройка остаётся доступной без отключения подсветки. | частично решено | 2025-09-24 |
| Кнопки «−»/«+» | Квадратные, без скруглений и заливки, не соответствуют общему стилю. | Hover: подсветки нет, стиль расходится с остальными контролами. | требует доработки | 2025-09-16 |
| Градиентные кнопки и селекторы цвета | В статике отображаются корректно, предпросмотр workspace/sidebar/градиента использует общий helper с радиусом 12 px и рамкой в `accent_color`. 2025-10-08: при смене цвета helper пересобирает стиль без мерцаний и сохраняет `NeonEventFilter`. | Hover: подсветка повторяет актуальный акцент, неон остаётся активным. | частично решено | 2025-10-08 |
| Кнопки «Сохранить»/«Отмена» | StyledPushButton, текст Exo 2, но выравнивание по левому краю и острые углы. | Hover: заливка сереет, неон гаснет. | требует доработки | 2025-09-16 |

### «Вводные данные» (StatsDialog)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Таблица сводки | NeonTableWidget синхронизирован с `workspace_color`, рамка и текст подхватывают `accent_color`. | Hover: неон поддерживается фильтром, подсветка повторяет актуальный акцент, розовый контур устранён. | частично решено | 2025-09-29 |
| Форма ввода | Поля смещаются при наведении, рамки угловатые. 2025-10-07: поля формы переходят на `build_input_neon_style`, фон и бордеры подхватывают актуальные `workspace_color`/`accent_color`, фильтры сохраняются для обновления темы. | Неон пропадает при фокусе, визуально выглядит сломанным. 2025-10-07: `StatsEntryForm.refresh_theme()` пересобирает стили без перезапуска диалога, при смене акцента рамки и подсветка обновляются. | частично решено | 2025-10-07 |
| Кнопки управления | StyledPushButton выравниваются по глобальному шаблону, фильтр включает неон на hover/фокус. | Hover: градиент сохраняется, активируется свечение по настройкам. | частично решено | 2025-09-29 |
| Сохранение состояния | Геометрия окна, ширина столбцов и порядок сортировки сохраняются в `QSettings`. | После обновления стиля восстановление выполняется корректно, параметры не теряются. | работает | 2025-09-29 |
| Фон | Цвет не совпадает с календарём. | При смене темы остаётся прежним. | требует доработки | 2025-09-16 |
| Выбор записи | Ранее редактировалась первая запись независимо от выбранной строки; выбор строки теперь корректно загружает соответствующую запись. | После сортировки и выбора строки форма редактирует нужную запись. | работает | 2025-09-18 |

### «Выкладка» (ReleaseDialog)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Таблица расписания | Рамки синхронизированы с `workspace_color` и неоновым акцентом, заголовки подсвечиваются тем же цветом. | Клик подсвечивает всю таблицу розовым контуром; количество строк теперь подстраивается под длину месяца, а ввод дней ограничен валидным диапазоном. 2025-09-28: стиль и неон пересобираются при смене палитры, таблица держит актуальный акцент. | частично решено | 2025-09-28 |
| Кнопки | Стиль и размеры не совпадают с остальными экранами; управляющие кнопки получают иконки из `assets/icons` для обеих тем. | Hover: фон серый, неон отсутствует. | частично решено | 2025-09-27 |
| Сохранение состояния | Диалог запоминает геометрию, ширины колонок и поддерживает несколько записей на один день. | После повторного открытия данные восстанавливаются. | работает | 2025-09-19 |
| Фон | Не синхронизирован с календарём. | Требуется привести к единому стилю. | требует доработки | 2025-09-16 |

### «Аналитика» (AnalyticsDialog)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Таблица показателей | NeonTableWidget синхронизирован с `workspace_color`, рамка и текст подхватывают актуальный `accent_color`. | Hover/фокус: фильтр включает неон, подсветка следует за сменой темы без розового контура. | частично решено | 2025-09-30 |
| Управляющие поля | Спинбоксы и фильтры различного стиля, углы острые. | Hover/фокус отключают неон, элементы смещаются. | требует доработки | 2025-09-16 |
| Сохранение состояния | Геометрия окна и ширина колонок сохраняются в `QSettings` после применения нового стиля. | Повторное открытие возвращает размеры и не отключает неон. | работает | 2025-09-30 |
| Фон | Цвет не совпадает с календарём. | Требуется синхронизация. | требует доработки | 2025-09-16 |

### «Топы» (TopDialog)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Панель фильтров | Спинбокс года и комбобоксы разностилевые, углы острые. | Hover: неон не активируется, подсветка отсутствует. | требует доработки | 2025-09-16 |
| Таблица результатов | NeonTableWidget синхронизирован с `workspace_color`, рамка и текст подхватывают `accent_color`; 2025-10-06: `TopDialog.refresh_theme()` пересобирает стиль при открытии. | Hover: фильтр поддерживает неон и текущий акцент, после смены темы окно обновляет подсветку без розового контура. | частично решено | 2025-10-06 |
| Кнопки | Размеры и стили отличаются, текст смещён к левому краю. | Hover: фон сереет, неон исчезает. | требует доработки | 2025-09-16 |
| Фон | Не соответствует календарю. | Требуется синхронизировать цвета. | требует доработки | 2025-09-16 |
| Левый бар | При открытии диалога заметны острые углы элементов сайдбара. | Возврат из диалога гасит неоновую подсветку кнопок. | требует доработки | 2025-09-16 |

## Настройки и темы
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Версия приложения | Файл `VERSION` содержит `3.1.20`, обновление номера по-прежнему выполняется вручную. | Требуется повышать версию при каждом фиксировании изменений. | требует доработки | 2025-10-08 |
| Палитра приложения | Цвет рабочего пространства синхронизирован с `workspace_color`, палитра Qt использует те же значения для окон, кнопок и выделения. | 2025-10-05: `MainWindow.apply_theme()` пересобирает `QPalette` на основе актуального `workspace_color`, повторно применяет её через `QApplication.setPalette` и обновляет открытые окна и диалоги. | решено | 2025-10-05 |
| Неоновая подсветка | Управляется пресетами («Мягкий», «Стандарт», «Яркий») и ползунками ширины/интенсивности; режим always-on зафиксирован. | Остальные экраны всё ещё глушат подсветку при hover, требуется выровнять визуальные состояния и перенести пресеты в остальные компоненты. | в процессе | 2025-09-24 |
| Шрифтовая тема | Конфигурация подставляет Cattedrale для заголовков и сайдбара. | Нужно ограничить выбор Exo 2 и запретить нестабильные гарнитуры. | требует доработки | 2025-09-16 |

## Общие проблемы реализации
- Нет единого базового класса или миксина для кнопок и полей, из-за чего стили разрознены.
- В кодовой базе остаются отключённые или неиспользуемые участки, усложняющие сопровождение.
- Не определены состояния UI-элементов (статичное, активное, при наведении, при фокусе), что приводит к непредсказуемому
  поведению.
- Модули взаимодействуют напрямую без чётких интерфейсов, отсутствует блочная структура.

## Дорожная карта
1. **Типографика и поддержка графических шрифтов.**
   - Зафиксировать Exo 2 как предустановленный шрифт для всех текстовых элементов, добавив проверку конфигурации (`header_font`, `sidebar_font`, `workspace_font`) при запуске.
   - Реализовать безопасную загрузку пользовательских графических шрифтов: выделенная директория `assets/fonts`, whitelist, проверка наличия кириллических и латинских глифов, graceful fallback на Exo 2 и журналирование ошибок подключения.
   - Обновить конфиг (`day_rows` → `4`), ввести контроль целостности настроек и визуальные регрессионные тесты для Exo 2 и кастомных гарнитур.
2. **Единый стиль кнопок и интерактивных элементов.**
   - Спроектировать базовый компонент для кнопок, чекбоксов и других активных контролов с центровкой текста, радиусом 16 px, градиентом `#39ff14→#2d7cdb`, едиными паддингами и поддержкой иконок.
   - Применить компонент к кнопкам левого бара («Вводные», «Выкладка», «Аналитика», «Топы», «Настройки», «Свернуть панель»), верхнего бара (перелистывание месяцев) и диалогов («Сохранить», «Отмена», управляющие кнопки), чтобы устранить смещение текста, серую заливку при hover и рассинхронизацию размеров.
   - Переработать кнопки «−/＋» и другие управляющие элементы настроек: скруглить углы, добавить фон/градиент, синхронизировать шрифт, выравнивание и неоновую подсветку с глобальным стилем.
3. **Неоновая подсветка (режим always-on).**
   - Удалить чекбокс отключения неона, заменить его на управление интенсивностью и шириной свечения через ползунки и предустановленные профили. 2025-09-24: диалог настроек получил пресеты «Мягкий/Стандарт/Яркий» и ползунки с цифровыми индикаторами.
   - Описать и внедрить состояния: статичное (тонкий контур), hover (усиленное свечение + текст `#39ff14`), активное (фиксированный ореол); исключить серые заливки и пропадание подсветки после взаимодействия.
   - Настроить неоновую рамку без «зубчатых» углов и добавить наружное свечение для кнопок, таблиц и полей, включая левый бар, топ-бар, диалоги и календарь.
4. **Левый сайдбар и верхняя панель.**
   - Сгладить визуальные углы корпуса сайдбара и topbar, синхронизировать фоны с календарём и обеспечить одинаковое свечение краёв.
   - Выровнять текст и иконки по центру во всех кнопках сайдбара; обеспечить постоянное свечение неона при наведении и после клика, предотвратить уход текста влево и появление серой заливки.
   - Для topbar устранить скачки цвета метки месяца, привести поле года к компактной ширине со скруглением и центрированием текста, а кнопкам перелистывания добавить наружное свечение и hover-состояния с подсвеченным текстом. 2025-09-25: фон topbar теперь пересобирает базовый стиль и очищает устаревший `background-color`, что подготовило почву для дальнейших правок визуальных углов и подсветки.
5. **Календарь и внутренняя сетка дня.**
   - Исправить ExcelCalendarTable: убрать масштабирование строк при клике, ограничить подсветку активной ячейкой и соответствующим заголовком столбца, предотвратить обводку всей таблицы при одинарном или двойном клике.
   - Выровнять фон строки заголовков и дней недели с основным календарём, зафиксировать единое поведение hover для чисел (без случайного серого свечения) и вернуть фон дня в исходное состояние после ухода курсора.
   - Реализовать скругление активной ячейки, восстановление фона после hover и корректную работу неоновой рамки без обводки всей таблицы.
6. **Диалоги левого бара («Вводные», «Выкладка», «Аналитика», «Топы»).**
   - Синхронизировать фон и радиусы с основной темой, настроить неоновую подсветку таблиц и кнопок, убрать розовый контур в пользу неоновой рамки.
   - Установить сохранение геометрии окон, ширины столбцов, порядка сортировки и введённых данных в `QSettings`; восстановление должно происходить при каждом открытии диалога.
   - Переработать управляющие кнопки и формы, чтобы они соответствовали глобальному стилю (центровка текста, скруглённые углы, неизменность масштаба при hover, подсветка текста).
7. **Версионирование и статус-бар.**
   - Автоматизировать обновление `VERSION`: скрипт после каждого merge повышает номер патча, переход на `3.1.2` зафиксирован в changelog; статус-бар считывает номер динамически.
   - Описать и зафиксировать параметры таймера (формат `ДД:ЧЧ:ММ:СС`, Exo 2 Regular ~9 pt, цвет `#202020`) и метки версии (тот же стиль), добавить проверки корректности отображения и синхронизации фона.
   - Убедиться, что фон статус-бара синхронизирован с календарём и неон не гаснет при обновлении показателей.
8. **Настройки и темы.**
   - Переработать диалог настроек: заменить числовые spinbox на ползунки, выровнять подписи, унифицировать радиусы, отступы и подсветку полей, синхронизировать фон с основной темой.
   - Обновить механизмы выбора цветов: предпросмотр, единый градиент, предотвращение рассинхронизации при смене темы, сохранение выбранных параметров. 2025-10-08: helper для предпросмотра workspace/sidebar/градиента использует актуальные `workspace_color`/`accent_color` и автоматически переустанавливает неон без мерцаний.
   - Внедрить набор пресетов (светлая/тёмная/неоновая) с описанием параметров и возможностью отката к дефолту, сохраняя стабильность неона.
9. **Архитектура и чистка кода.**
   - Выделить модули для компонентов (кнопки, поля, таблицы), тем (шрифты, цвета, неон), данных (планы, статистика) и сервисов (сохранение состояний, версионирование).
   - Удалить неиспользуемые блоки, переписать копипасту на наследование/композицию, внедрить unit/UI-тесты для критичных участков (неон, сохранение, загрузка шрифтов, версии).
   - Задокументировать архитектурные принципы и правила код-ревью, чтобы поддерживать единый стиль в будущем.
10. **Поддержка документа CHECKLIST + ROAD MAP.**
    - После каждого фиксирования задачи обновлять соответствующие записи чек-листа (описание, статус, дата) и синхронизировать дорожную карту с фактическим прогрессом.
    - Добавить пункт проверки в процессы ревью/релиза, гарантирующий, что документ отражает актуальное состояние стабильных и проблемных компонентов.
