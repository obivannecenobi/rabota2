# CHECKLIST + ROAD MAP

Комбинированный чек-лист и дорожная карта по приложению «План-график» фиксируют текущее состояние интерфейса, перечисляют визуальные и поведенческие проблемы и помогают планировать доработки. После каждого изменения обновляйте статусы, даты и план работ.

## Глобальные наблюдения
- **Шрифты.** Конфигурация по умолчанию (`data/config.json`) устанавливает `header_font` и `sidebar_font` в значение
  `Cattedrale [RUS by penka220]`, тогда как рендерер стабильно отображает только семейство Exo 2. Попытка загрузить кастомный
  файл приводит к нечитабельному тексту и ранее блокировала запуск приложения. Требуется сохранить Exo 2 в качестве
  дефолтной гарнитуры и одновременно проработать безопасную поддержку графических шрифтов (отдельная директория ресурсов,
  fallback при ошибке, проверка наличия глифов).
- **Единый стиль кнопок.** StyledToolButton/StyledPushButton визуально отличаются друг от друга: заметны острые углы у элементов
  со скруглением, текст в кнопках навигации и диалогов смещён к левому краю, при наведении используется серая заливка и неон
  полностью гаснет. Нужен общий компонент с центровкой текста и стабильной подсветкой.
- **Неоновая подсветка.** Нет единого правила, где и как она работает: в большинстве экранов при наведении она исчезает, на
  некоторых кнопках свет не выходит наружу, а рамки становятся угловатыми. Текущий UI допускает отключение неона, хотя он должен
  быть активен постоянно. Требуется единая система состояний «статичное / активное / динамичное» с режимом always-on.
- **Сохранение состояний.** Диалоги из левого бара (вводные, выкладка, аналитика, топы) не запоминают размеры окон, ширину
  столбцов, значения сортировки и введённые данные таблиц после закрытия.
- **Архитектура.** Код разросся за счёт копипаста стилей и обработчиков; отсутствует модульность и ООП-подход для повторяющихся
  элементов (кнопки, поля, таблицы). Есть отключённые блоки, которые не удалены.

## Главный экран

### Левый сайдбар
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата последней проверки |
| --- | --- | --- | --- | --- |
| Корпус боковой панели | Фон синхронизируется с `sidebar_color` (`#1f1f23`), ширина 260 px; углы выглядят зубчатыми, заголовки подхватывают Cattedrale вместо Exo 2. | Сворачивание анимирует ширину, фон обновляется, неон подсвечивает края угловато и без внешнего свечения. | требует доработки | 2025-09-16 |
| Кнопка «Свернуть панель» | Градиент `#39ff14→#2d7cdb`, радиус 16 px, иконка 28×28 цвета `#ffffff`; отсутствие текста подчёркивает смещение и острые углы. | Hover: фон `#3a3a3a`, подсветка и неон гаснут, масштаб не меняется; иконка тускнеет, после клика подсветка не возвращается. | требует доработки | 2025-09-16 |
| Кнопка «Вводные» | Exo 2 16 px, текст `#ffffff` и иконка `#39ff14` прижаты к левому краю, градиент `#39ff14→#2d7cdb`, радиус 16 px; углы рендерятся ступенчато. | Hover: заливка сереет, текст обесцвечивается до `#bfbfbf`, неон отключается, внешнее свечение отсутствует; активное состояние сбрасывается после закрытия окна. | требует доработки | 2025-09-16 |
| Кнопка «Выкладка» | Аналогично «Вводные»: Exo 2 16 px, текст `#ffffff`, иконка 22×22 `#39ff14`, центрирование отсутствует, острые углы заметны. | Hover/клик: градиент тускнеет до серого, текст неонового свечения не получает, внешнего ореола нет, неон гаснет полностью. | требует доработки | 2025-09-16 |
| Кнопка «Аналитика» | StyledToolButton с Exo 2 16 px, текст `#ffffff`, иконка `#39ff14`; визуально видны острые углы и смещение контента к левому краю. | Hover: фон сереет, текст становится `#bfbfbf`, неон и подсветка исчезают; после закрытия диалога подсветка не восстанавливается. | требует доработки | 2025-09-16 |
| Кнопка «Топы» | Текст `#ffffff` и иконка `#39ff14` смещены к левому краю, справа остаётся пустое поле; углы неровные. | Hover: фон серый, текст тускнеет до `#bfbfbf`, неон гаснет, свечение по контуру отсутствует; при открытии окна подсветка сбрасывается. | требует доработки | 2025-09-16 |
| Кнопка «Настройки» | Icon-only, градиент `#39ff14→#2d7cdb`, радиус 16 px; края выглядят острыми, подсветка узкая, иконка `#ffffff`. | Hover: фон сереет, неон и рамка исчезают, наружное свечение отсутствует даже при активном режиме. | требует доработки | 2025-09-16 |

### Верхняя панель (TopBar)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Фон TopBar | Цвет синхронизирован с календарём (по умолчанию `#222222`), переход к центральной области выглядит квадратным. | При смене темы фон обновляется, но поле года остаётся иного цвета и выбивается из общего тона. | требует доработки | 2025-09-16 |
| Кнопки «Предыдущий/Следующий» | Градиент `#39ff14→#2d7cdb`, радиус 16 px, стрелки 22×22 цвета `#ffffff`; отсутствие текста подчёркивает смещение и острые углы. | Hover: фон становится `#3a3a3a`, иконка тускнеет до `#bfbfbf`, наружного неона нет. | требует доработки | 2025-09-16 |
| Метка месяца | QLabel, планируемый Exo 2 Bold 24 px, но конфиг подставляет Cattedrale; цвет скачет между `#ffffff` и `#39ff14`. | При смене темы цвет без логики переключается между состояниями, текст светится даже без активного неона. | требует доработки | 2025-09-16 |
| Поле года | QSpinBox без стрелок, ширина избыточна; текст Exo 2 18 px выровнен по левому краю, фон отличается от топ-бара. | Hover: фон не синхронизируется, бордер угловат, текст не центрируется; при смене темы цвет поля не обновляется. | требует доработки | 2025-09-16 |

### Центральная рабочая область (календарь)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Таблица месяца (ExcelCalendarTable) | 7×6 ячеек, фон из `workspace_color`, внешние углы выглядят острыми. | Клик по ячейке подсвечивает все границы таблицы; двойной клик подсвечивает весь календарь. | требует доработки | 2025-09-16 |
| Контейнер дня | QWidget с радиусом 8 px, но активная ячейка визуально квадратная. | Hover: фон меняется и не всегда возвращается; клик увеличивает масштаб и ломает скругление. | требует доработки | 2025-09-16 |
| Внутренняя таблица дня | NeonTableWidget с 6 строками («Работа/План/Готово»). | Выбор подсвечивает всю таблицу, заголовки всех столбцов начинают светиться, масштаб строки скачет. | требует доработки | 2025-09-16 |
| Заголовки столбцов внутри дня | Exo 2, но фон отличается от календаря. | Цвет и фон меняются в зависимости от действий, нет статического состояния. | требует доработки | 2025-09-16 |
| Заголовок дней недели (ПН…ВС) | Отдельная заливка, отличная от календаря; шрифт и цвет корректны. | Hover на первой неделе подсвечивает число серым, на остальных неделях поведение непредсказуемо. | требует доработки | 2025-09-16 |

### Нижний статус-бар
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Таймер | QLabel «ДД:ЧЧ:ММ:СС», Exo 2 Regular, системный размер ~9 pt, цвет из палитры светлой темы (`#202020`). | Обновляется раз в секунду, подсветка и цвет стабильны. | работает | 2025-09-16 |
| Метка версии | QLabel `v<номер>`, Exo 2 Regular ~9 pt, цвет `#202020`; файл `VERSION` содержит актуальную `3.1.2`, обновление выполняется вручную. | Обновление версии не автоматизировано, фиксы не повышают номер. | требует доработки | 2025-09-17 |
| Фон статус-бара | Цвет синхронизирован с календарём. | Изменения цвета применяются корректно. | работает | 2025-09-16 |

## Диалоги

### «Настройки» (SettingsDialog)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Поле «Строк на день» | QSpinBox без стрелок, по умолчанию `6` вместо ожидаемых `4`; углы выглядят угловатыми. | Hover: меняется паддинг, поле смещается, неоновая рамка исчезает. | требует доработки | 2025-09-16 |
| Группа «Неон включен» | Чекбокс и три spinbox с числовыми значениями; внешний вид нечитаемый. | Hover: поля теряют неоновую рамку, углы выглядят острыми; текущая логика допускает отключение подсветки, что противоречит требованию всегда активного неона. | требует доработки | 2025-09-16 |
| Кнопки «−»/«+» | Квадратные, без скруглений и заливки, не соответствуют общему стилю. | Hover: подсветки нет, стиль расходится с остальными контролами. | требует доработки | 2025-09-16 |
| Градиентные кнопки и селекторы цвета | В статике отображаются корректно, но углы выглядят острыми. | Hover: неон не появляется, подсветка отсутствует. | требует доработки | 2025-09-16 |
| Кнопки «Сохранить»/«Отмена» | StyledPushButton, текст Exo 2, но выравнивание по левому краю и острые углы. | Hover: заливка сереет, неон гаснет. | требует доработки | 2025-09-16 |

### «Вводные данные» (StatsDialog)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Таблица сводки | NeonTableWidget с бледным свечением. | Hover: подсветка почти не видна; выделение строки даёт розовый контур вместо неоновой рамки. | требует доработки | 2025-09-16 |
| Форма ввода | Поля смещаются при наведении, рамки угловатые. | Неон пропадает при фокусе, визуально выглядит сломанным. | требует доработки | 2025-09-16 |
| Кнопки управления | Размеры и стиль отличаются от глобальных кнопок. | Hover: фон серый, неон гаснет. | требует доработки | 2025-09-16 |
| Сохранение состояния | Геометрия окна, ширина столбцов и сортировка не сохраняются. | После закрытия диалога всё сбрасывается. | требует доработки | 2025-09-16 |
| Фон | Цвет не совпадает с календарём. | При смене темы остаётся прежним. | требует доработки | 2025-09-16 |
| Выбор записи | Ранее редактировалась первая запись независимо от выбранной строки; выбор строки теперь корректно загружает соответствующую запись. | После сортировки и выбора строки форма редактирует нужную запись. | работает | 2025-09-18 |

### «Выкладка» (ReleaseDialog)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Таблица расписания | Рамки угловатые, неон почти не заметен. | Клик подсвечивает всю таблицу розовым контуром. | требует доработки | 2025-09-16 |
| Кнопки | Стиль и размеры не совпадают с остальными экранами. | Hover: фон серый, неон отсутствует. | требует доработки | 2025-09-16 |
| Сохранение состояния | Диалог запоминает геометрию, ширины колонок и поддерживает несколько записей на один день. | После повторного открытия данные восстанавливаются. | работает | 2025-09-19 |
| Фон | Не синхронизирован с календарём. | Требуется привести к единому стилю. | требует доработки | 2025-09-16 |

### «Аналитика» (AnalyticsDialog)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Таблица показателей | Неон не отображается. | Hover: подсветка отсутствует, выделение розовым контуром. | требует доработки | 2025-09-16 |
| Управляющие поля | Спинбоксы и фильтры различного стиля, углы острые. | Hover/фокус отключают неон, элементы смещаются. | требует доработки | 2025-09-16 |
| Сохранение состояния | Геометрия окна, ширина колонок и сортировка не сохраняются. | После закрытия всё сбрасывается. | требует доработки | 2025-09-16 |
| Фон | Цвет не совпадает с календарём. | Требуется синхронизация. | требует доработки | 2025-09-16 |

### «Топы» (TopDialog)
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Панель фильтров | Спинбокс года и комбобоксы разностилевые, углы острые. | Hover: неон не активируется, подсветка отсутствует. | требует доработки | 2025-09-16 |
| Таблица результатов | Неон не отображается, выделение розовым контуром. | Сортировка и ширина колонок не сохраняются. | требует доработки | 2025-09-16 |
| Кнопки | Размеры и стили отличаются, текст смещён к левому краю. | Hover: фон сереет, неон исчезает. | требует доработки | 2025-09-16 |
| Фон | Не соответствует календарю. | Требуется синхронизировать цвета. | требует доработки | 2025-09-16 |
| Левый бар | При открытии диалога заметны острые углы элементов сайдбара. | Возврат из диалога гасит неоновую подсветку кнопок. | требует доработки | 2025-09-16 |

## Настройки и темы
| Элемент | Статичное состояние | Поведение при взаимодействии | Статус | Дата |
| --- | --- | --- | --- | --- |
| Версия приложения | Файл `VERSION` содержит `3.1.4`, обновление номера выполняется вручную. | Требуется повышать версию при каждом фиксировании изменений. | требует доработки | 2025-09-19 |
| Неоновая подсветка | Управляется чекбоксом «Неон включен», хотя подсветка должна оставаться активной постоянно; параметры задаются численно через spinbox. | Нет глобального правила применения: большинство элементов гасит подсветку на hover, отсутствует механизм принудительного always-on и единых пресетов. | требует доработки | 2025-09-16 |
| Шрифтовая тема | Конфигурация подставляет Cattedrale для заголовков и сайдбара. | Нужно ограничить выбор Exo 2 и запретить нестабильные гарнитуры. | требует доработки | 2025-09-16 |

## Общие проблемы реализации
- Нет единого базового класса или миксина для кнопок и полей, из-за чего стили разрознены.
- В кодовой базе остаются отключённые или неиспользуемые участки, усложняющие сопровождение.
- Не определены состояния UI-элементов (статичное, активное, при наведении, при фокусе), что приводит к непредсказуемому
  поведению.
- Модули взаимодействуют напрямую без чётких интерфейсов, отсутствует блочная структура.

## Дорожная карта
1. **Типографика и поддержка графических шрифтов.**
   - Зафиксировать Exo 2 как предустановленный шрифт для всех текстовых элементов, добавив проверку конфигурации (`header_font`, `sidebar_font`, `workspace_font`) при запуске.
   - Реализовать безопасную загрузку пользовательских графических шрифтов: выделенная директория `assets/fonts`, whitelist, проверка наличия кириллических и латинских глифов, graceful fallback на Exo 2 и журналирование ошибок подключения.
   - Обновить конфиг (`day_rows` → `4`), ввести контроль целостности настроек и визуальные регрессионные тесты для Exo 2 и кастомных гарнитур.
2. **Единый стиль кнопок и интерактивных элементов.**
   - Спроектировать базовый компонент для кнопок, чекбоксов и других активных контролов с центровкой текста, радиусом 16 px, градиентом `#39ff14→#2d7cdb`, едиными паддингами и поддержкой иконок.
   - Применить компонент к кнопкам левого бара («Вводные», «Выкладка», «Аналитика», «Топы», «Настройки», «Свернуть панель»), верхнего бара (перелистывание месяцев) и диалогов («Сохранить», «Отмена», управляющие кнопки), чтобы устранить смещение текста, серую заливку при hover и рассинхронизацию размеров.
   - Переработать кнопки «−/＋» и другие управляющие элементы настроек: скруглить углы, добавить фон/градиент, синхронизировать шрифт, выравнивание и неоновую подсветку с глобальным стилем.
3. **Неоновая подсветка (режим always-on).**
   - Удалить чекбокс отключения неона, заменить его на управление интенсивностью и шириной свечения через ползунки и предустановленные профили.
   - Описать и внедрить состояния: статичное (тонкий контур), hover (усиленное свечение + текст `#39ff14`), активное (фиксированный ореол); исключить серые заливки и пропадание подсветки после взаимодействия.
   - Настроить неоновую рамку без «зубчатых» углов и добавить наружное свечение для кнопок, таблиц и полей, включая левый бар, топ-бар, диалоги и календарь.
4. **Левый сайдбар и верхняя панель.**
   - Сгладить визуальные углы корпуса сайдбара и topbar, синхронизировать фоны с календарём и обеспечить одинаковое свечение краёв.
   - Выровнять текст и иконки по центру во всех кнопках сайдбара; обеспечить постоянное свечение неона при наведении и после клика, предотвратить уход текста влево и появление серой заливки.
   - Для topbar устранить скачки цвета метки месяца, привести поле года к компактной ширине со скруглением и центрированием текста, а кнопкам перелистывания добавить наружное свечение и hover-состояния с подсвеченным текстом.
5. **Календарь и внутренняя сетка дня.**
   - Исправить ExcelCalendarTable: убрать масштабирование строк при клике, ограничить подсветку активной ячейкой и соответствующим заголовком столбца, предотвратить обводку всей таблицы при одинарном или двойном клике.
   - Выровнять фон строки заголовков и дней недели с основным календарём, зафиксировать единое поведение hover для чисел (без случайного серого свечения) и вернуть фон дня в исходное состояние после ухода курсора.
   - Реализовать скругление активной ячейки, восстановление фона после hover и корректную работу неоновой рамки без обводки всей таблицы.
6. **Диалоги левого бара («Вводные», «Выкладка», «Аналитика», «Топы»).**
   - Синхронизировать фон и радиусы с основной темой, настроить неоновую подсветку таблиц и кнопок, убрать розовый контур в пользу неоновой рамки.
   - Установить сохранение геометрии окон, ширины столбцов, порядка сортировки и введённых данных в `QSettings`; восстановление должно происходить при каждом открытии диалога.
   - Переработать управляющие кнопки и формы, чтобы они соответствовали глобальному стилю (центровка текста, скруглённые углы, неизменность масштаба при hover, подсветка текста).
7. **Версионирование и статус-бар.**
   - Автоматизировать обновление `VERSION`: скрипт после каждого merge повышает номер патча, переход на `3.1.2` зафиксирован в changelog; статус-бар считывает номер динамически.
   - Описать и зафиксировать параметры таймера (формат `ДД:ЧЧ:ММ:СС`, Exo 2 Regular ~9 pt, цвет `#202020`) и метки версии (тот же стиль), добавить проверки корректности отображения и синхронизации фона.
   - Убедиться, что фон статус-бара синхронизирован с календарём и неон не гаснет при обновлении показателей.
8. **Настройки и темы.**
   - Переработать диалог настроек: заменить числовые spinbox на ползунки, выровнять подписи, унифицировать радиусы, отступы и подсветку полей, синхронизировать фон с основной темой.
   - Обновить механизмы выбора цветов: предпросмотр, единый градиент, предотвращение рассинхронизации при смене темы, сохранение выбранных параметров.
   - Внедрить набор пресетов (светлая/тёмная/неоновая) с описанием параметров и возможностью отката к дефолту, сохраняя стабильность неона.
9. **Архитектура и чистка кода.**
   - Выделить модули для компонентов (кнопки, поля, таблицы), тем (шрифты, цвета, неон), данных (планы, статистика) и сервисов (сохранение состояний, версионирование).
   - Удалить неиспользуемые блоки, переписать копипасту на наследование/композицию, внедрить unit/UI-тесты для критичных участков (неон, сохранение, загрузка шрифтов, версии).
   - Задокументировать архитектурные принципы и правила код-ревью, чтобы поддерживать единый стиль в будущем.
10. **Поддержка документа CHECKLIST + ROAD MAP.**
    - После каждого фиксирования задачи обновлять соответствующие записи чек-листа (описание, статус, дата) и синхронизировать дорожную карту с фактическим прогрессом.
    - Добавить пункт проверки в процессы ревью/релиза, гарантирующий, что документ отражает актуальное состояние стабильных и проблемных компонентов.
